#
# Nimbella CONFIDENTIAL
# ---------------------
#
#   2018 - present Nimbella Corp
#   All Rights Reserved.
#
# NOTICE:
#
# All information contained herein is, and remains the property of
# Nimbella Corp and its suppliers, if any.  The intellectual and technical
# concepts contained herein are proprietary to Nimbella Corp and its
# suppliers and may be covered by U.S. and Foreign Patents, patents
# in process, and are protected by trade secret or copyright law.
#
# Dissemination of this information or reproduction of this material
# is strictly forbidden unless prior written permission is obtained
# from Nimbella Corp.
#

# This tests actionWrapping
# the chat demo test.  A single optional argument will run a single test, including chat.

SELFDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
DEMODIR="$SELFDIR/../../../demo-projects"
cd $SELFDIR

set -e
nim namespace clean --force
rm -fr calculator
cp -r $DEMODIR/calculator .
echo "actionWrapPackage: default" > calculator/project.yml
nim project deploy calculator
INDEX_URL=$(nim action get index --url)
curl -s $INDEX_URL > calculator/compare_index.html
LOGO_URL=$(nim action get logo.png --url)
curl -s $LOGO_URL > calculator/compare_logo.png
diff -q calculator/web/index.html calculator/compare_index.html
diff -q calculator/web/logo.png calculator/compare_logo.png
echo "All tests succeeded"
